orbs:
  maven: circleci/maven@1.0.3
  docker: circleci/docker@1.5.0

version: 2.1
workflows:
  maven_test:
    jobs:
      - maven/test:
          command: '-X clean'
      - maven/test:
          command: 'com.google.cloud.tools:jib-maven-plugin:0.9.7:dockerBuild -X'
  push-images:
    jobs:
      - push:
         steps:
            - setup_remote_docker:
                version: 19.03.13
                docker_layer_caching: true
            - run:
                name: "Push and Run"
                command: |
                  echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin
                  docker push nishshukla/casting/com.waa-casting:latest
